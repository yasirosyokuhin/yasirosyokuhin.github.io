
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ“ãƒ‡ã‚ªãƒãƒ¼ã‚«ãƒ¼</title>
    <style>
body {
    font-family: 'Arial', sans-serif;
    text-align: center;
    background-color: #006400;
    color: white;
    margin: 0;
    padding: 10px;
    touch-action: manipulation;
    user-select: none;
}

#game-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 10px;
}

#info-panel {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding: 10px;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 10px;
}

#cards-container {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
}

.card {
    width: 120px;
    height: 180px;
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    cursor: pointer;
    transition: transform 0.2s;
    transform-style: preserve-3d;
    perspective: 1000px;
}

.card.held {
    /* ãƒˆãƒ©ãƒ³ãƒ—ã¯å‹•ã‹ã•ãšä¸‹ã«ã€Œãƒ›ãƒ¼ãƒ«ãƒ‰ã€ã¨è¡¨ç¤ºã™ã‚‹ */
}

.card.flip {
    animation: flipCard 0.6s ease-out;
}

.card.new-card {
    animation: newCardAnimation 0.5s ease-out;
}

@keyframes flipCard {
    0% { transform: rotateY(0deg); }
    50% { transform: rotateY(90deg); }
    100% { transform: rotateY(0deg); }
}

@keyframes newCardAnimation {
    0% { transform: rotateY(90deg) scale(0.8); opacity: 0.5; }
    100% { transform: rotateY(0deg) scale(1); opacity: 1; }
}

.card-back {
    background-color: #0000AA;
    background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px);
}

.card-suit {
    font-size: 60px;
    line-height: 1;
}

.card-value {
    font-size: 24px;
    font-weight: bold;
    position: absolute;
    top: 10px;
    left: 10px;
}

.card-value-bottom {
    font-size: 24px;
    font-weight: bold;
    position: absolute;
    bottom: 10px;
    right: 10px;
    transform: rotate(180deg);
}

.heart, .diamond {
    color: #FF0000;
}

.spade, .club {
    color: #000000;
}

.joker {
    color: #FF00FF;
}

.face-card {
    width: 80px;
    height: 80px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 34px;
}

.held-text {
    position: absolute;
    bottom: -35px; /* é–“éš”ã‚’ã•ã‚‰ã«åºƒã’ãŸ */
    color: #FFD700;
    font-weight: bold;
    font-size: 18px; /* å°‘ã—å¤§ããã—ãŸ */
    text-shadow: 1px 1px 2px black;
}

#buttons-container {
    display: flex;
    justify-content: center;
    gap: 15px; /* é–“éš”ã‚’åºƒã’ãŸ */
    margin: 35px 0 20px; /* ãƒ›ãƒ¼ãƒ«ãƒ‰è¡¨ç¤ºã¨ã®é–“éš”ã‚’ç¢ºä¿ */
    flex-wrap: wrap;
}

button {
    padding: 14px 24px; /* ãƒœã‚¿ãƒ³ã‚’å¤§ããã—ãŸ */
    font-size: 16px;
    border: none;
    border-radius: 5px;
    background-color: #FFD700;
    color: #000;
    cursor: pointer;
    transition: background-color 0.3s;
}

button:hover {
    background-color: #FFC107;
}

button:disabled {
    background-color: #cccccc;
    color: #666666;
    cursor: not-allowed;
}

#result {
    margin-top: 15px;
    font-size: 24px;
    font-weight: bold;
    min-height: 30px;
}

#double-up-container {
    display: none;
    flex-direction: column;
    align-items: center;
    margin-top: 10px;
    padding: 20px;
    background: linear-gradient(135deg, #2c3e50, #4a235a);
    border-radius: 15px;
    max-width: 450px;
    margin-left: auto;
    margin-right: auto;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4), 0 0 40px rgba(255, 215, 0, 0.2);
    border: 2px solid #d4af37;
    position: relative;
    overflow: hidden;
}

#double-up-container::before {
    content: '';
    position: absolute;
    top: -10px;
    left: -10px;
    right: -10px;
    bottom: -10px;
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 20px;
    animation: pulse 1.5s infinite alternate;
    pointer-events: none;
}

@keyframes pulse {
    0% { opacity: 0.6; transform: scale(1); }
    100% { opacity: 1; transform: scale(1.03); }
}

#double-up-container h3 {
    margin: 0 0 15px 0;
    color: #FFD700;
    font-size: 28px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    letter-spacing: 1px;
}

#dealer-card {
    margin: 15px 0;
    background-color: white;
    transform: scale(1.1);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 10px rgba(255, 215, 0, 0.5);
}

/* æ¨ªä¸¦ã³ã®ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºç”¨ */
#cards-comparison {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 15px 0;
}

#double-up-options {
    display: flex;
    gap: 20px;
    margin-top: 20px;
}

#double-up-options button {
    padding: 12px 25px;
    font-weight: bold;
    background: linear-gradient(to bottom, #FFD700, #FFC107);
    border: 1px solid #d4af37;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    transition: all 0.3s;
}

#double-up-options button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    background: linear-gradient(to bottom, #FFC107, #FFD700);
}

#paytable {
    margin-top: 20px;
    border-collapse: collapse;
    width: 100%;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 10px;
}

#paytable th, #paytable td {
    padding: 8px;
    border: 1px solid #444;
}

#paytable th {
    background-color: #333;
}

#win-amount {
    font-size: 28px;
    color: #FFD700;
    margin: 10px 0;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    font-weight: bold;
}

@media (max-width: 600px) {
    .card {
        width: 60px;
        height: 90px;
    }
    
    .card-suit {
        font-size: 30px;
    }
    
    .card-value, .card-value-bottom {
        font-size: 14px;
        top: 5px;
        left: 5px;
    }
    
    .card-value-bottom {
        bottom: 5px;
        right: 5px;
    }
    
    .held-text {
        bottom: -30px;
        font-size: 14px;
    }
    
    button {
        padding: 10px 16px;
        font-size: 14px;
    }
    
    .face-card {
        width: 40px;
        height: 40px;
        font-size: 20px;
    }
    
    #double-up-container h3 {
        font-size: 22px;
    }
    
    #win-amount {
        font-size: 22px;
    }
}

#message-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

#message-box {
    background-color: white;
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    max-width: 80%;
}

#message-box h2 {
    color: #d4af37;
    margin-top: 0;
}

#message-box p {
    color: #333;
    font-size: 18px;
    margin-bottom: 20px;
}

#message-box button {
    padding: 10px 20px;
    font-size: 16px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
    </style>
</head>
<body>
    <div id="game-container">
        <h1>ãƒ“ãƒ‡ã‚ªãƒãƒ¼ã‚«ãƒ¼</h1>
        
        <div id="info-panel">
            <div id="coins">ã‚³ã‚¤ãƒ³: <span id="coins-value">300</span></div>
            <div id="bet">ãƒ™ãƒƒãƒˆ: 10ã‚³ã‚¤ãƒ³</div>
        </div>
        
        <div id="cards-container">
            <div class="card card-back" id="card-0"></div>
            <div class="card card-back" id="card-1"></div>
            <div class="card card-back" id="card-2"></div>
            <div class="card card-back" id="card-3"></div>
            <div class="card card-back" id="card-4"></div>
        </div>
        
        <div id="buttons-container">
            <button id="deal-btn">ã‚«ãƒ¼ãƒ‰ã‚’é…ã‚‹</button>
            <button id="draw-btn" disabled>ã‚«ãƒ¼ãƒ‰ã‚’äº¤æ›</button>
        </div>
        
        <div id="result"></div>
        
        <div id="double-up-container">
            <h3>ãƒ€ãƒ–ãƒ«ã‚¢ãƒƒãƒ—ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h3>
            <div id="win-amount"></div>
            <div id="cards-comparison">
                <div class="card" id="dealer-card"></div>
                <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
            </div>
            <div id="double-up-options">
                <button id="higher-btn">é«˜ã„</button>
                <button id="lower-btn">ä½ã„</button>
                <button id="collect-btn">ç²å¾—ã™ã‚‹</button>
            </div>
        </div>
        
        <table id="paytable">
            <tr>
                <th>å½¹</th>
                <th>é…å½“</th>
            </tr>
            <tr>
                <td>ãƒ¯ãƒ³ãƒšã‚¢</td>
                <td>5</td>
            </tr>
            <tr>
                <td>ãƒ„ãƒ¼ãƒšã‚¢</td>
                <td>20</td>
            </tr>
            <tr>
                <td>ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰</td>
                <td>30</td>
            </tr>
            <tr>
                <td>ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ</td>
                <td>50</td>
            </tr>
            <tr>
                <td>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥</td>
                <td>50</td>
            </tr>
            <tr>
                <td>ãƒ•ãƒ«ãƒã‚¦ã‚¹</td>
                <td>100</td>
            </tr>
            <tr>
                <td>ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰</td>
                <td>150</td>
            </tr>
            <tr>
                <td>ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥</td>
                <td>250</td>
            </tr>
            <tr>
                <td>ãƒ•ã‚¡ã‚¤ãƒ–ã‚«ãƒ¼ãƒ‰</td>
                <td>300</td>
            </tr>
            <tr>
                <td>ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥</td>
                <td>1000</td>
            </tr>
        </table>
    </div>
    
    <div id="message-overlay">
        <div id="message-box">
            <h2>ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</h2>
            <p>ã‚³ã‚¤ãƒ³ãŒ1000æšã‚’è¶…ãˆã¾ã—ãŸï¼ã‚ãªãŸã¯ãƒ“ãƒ‡ã‚ªãƒãƒ¼ã‚«ãƒ¼ã®é”äººã§ã™ï¼</p>
            <button id="continue-btn">ç¶šã‘ã‚‹</button>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹
        const gameState = {
            coins: 300,
            betAmount: 10,
            deck: [],
            currentHand: [],
            heldCards: [false, false, false, false, false],
            gamePhase: 'initial', // initial, deal, draw, result, doubleUp
            winAmount: 0,
            doubleUpAmount: 0,
            dealerCard: null,
            playerCard: null,
            goalReached: false,
            replacedCardIndices: [],
            pendingWin: false // å½¹ãŒæƒã£ãŸãŒç²å¾—ã—ã¦ã„ãªã„çŠ¶æ…‹ã‚’ç®¡ç†
        };

        // DOMè¦ç´ 
        const dealBtn = document.getElementById('deal-btn');
        const drawBtn = document.getElementById('draw-btn');
        const resultDiv = document.getElementById('result');
        const coinsValue = document.getElementById('coins-value');
        const doubleUpContainer = document.getElementById('double-up-container');
        const winAmountDiv = document.getElementById('win-amount');
        const dealerCardDiv = document.getElementById('dealer-card');
        const cardsComparisonDiv = document.getElementById('cards-comparison');
        const higherBtn = document.getElementById('higher-btn');
        const lowerBtn = document.getElementById('lower-btn');
        const collectBtn = document.getElementById('collect-btn');
        const messageOverlay = document.getElementById('message-overlay');
        const continueBtn = document.getElementById('continue-btn');

        // ã‚«ãƒ¼ãƒ‰ã®ã‚¹ãƒ¼ãƒˆã€å€¤ã€ç‰¹æ®Šè¡¨ç¤º
        const suits = {
            'heart': { symbol: 'â™¥', display: 'â™¥', color: 'heart' },
            'diamond': { symbol: 'â™¦', display: 'â™¦', color: 'diamond' },
            'club': { symbol: 'â™£', display: 'â™£', color: 'club' },
            'spade': { symbol: 'â™ ', display: 'â™ ', color: 'spade' },
            'joker': { symbol: 'ğŸƒ', display: 'ğŸƒ', color: 'joker' }
        };

        const values = {
            'A': { value: 14, display: 'A' },
            '2': { value: 2, display: '2' },
            '3': { value: 3, display: '3' },
            '4': { value: 4, display: '4' },
            '5': { value: 5, display: '5' },
            '6': { value: 6, display: '6' },
            '7': { value: 7, display: '7' },
            '8': { value: 8, display: '8' },
            '9': { value: 9, display: '9' },
            '10': { value: 10, display: '10' },
            'J': { value: 11, display: 'J', face: 'ğŸ‘¨â€âš–ï¸' },
            'Q': { value: 12, display: 'Q', face: 'ğŸ‘¸' },
            'K': { value: 13, display: 'K', face: 'ğŸ¤´' },
            'Joker': { value: 15, display: 'Joker' }
        };

        // é…å½“è¡¨
        const payouts = {
            'ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥': 1000,
            'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥': 250,
            'ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰': 150,
            'ãƒ•ãƒ«ãƒã‚¦ã‚¹': 100,
            'ãƒ•ãƒ©ãƒƒã‚·ãƒ¥': 50,
            'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ': 50,
            'ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰': 30,
            'ãƒ„ãƒ¼ãƒšã‚¢': 20,
            'ãƒ¯ãƒ³ãƒšã‚¢': 5,
            'ãƒ•ã‚¡ã‚¤ãƒ–ã‚«ãƒ¼ãƒ‰': 300
        };

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        function initGame() {
            updateCoinsDisplay();
            
            // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§ãƒ›ãƒ¼ãƒ«ãƒ‰
            document.querySelectorAll('.card').forEach((card, index) => {
                card.addEventListener('click', () => {
                    if (gameState.gamePhase === 'deal') {
                        toggleHold(index);
                    }
                });
            });
            
            // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            dealBtn.addEventListener('click', dealOrCollect);
            drawBtn.addEventListener('click', drawCards);
            higherBtn.addEventListener('click', () => doubleUp('higher'));
            lowerBtn.addEventListener('click', () => doubleUp('lower'));
            collectBtn.addEventListener('click', collectWinnings);
            continueBtn.addEventListener('click', () => {
                messageOverlay.style.display = 'none';
            });
        }

        // ã‚«ãƒ¼ãƒ‰ã‚’é…ã‚‹ã¾ãŸã¯ç²å¾—ã™ã‚‹
        function dealOrCollect() {
    if (gameState.pendingWin) {
        // å‹åˆ©é‡‘ãŒã‚ã‚‹å ´åˆã¯ç²å¾—ã™ã‚‹
        gameState.coins += gameState.winAmount;
        updateCoinsDisplay();
        
        gameState.pendingWin = false;
        // ãƒ€ãƒ–ãƒ«ã‚¢ãƒƒãƒ—ã®æ¬„ã‚’é–‰ã˜ã‚‹
        doubleUpContainer.style.display = 'none';
        // ä¿®æ­£ç‚¹: ç²å¾—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã›ãšã€ã™ãã«æ¬¡ã®ã‚²ãƒ¼ãƒ ã¸é€²ã‚€
        dealCards();
        
        // 1000ã‚³ã‚¤ãƒ³ä»¥ä¸Šã§ã‚´ãƒ¼ãƒ«é”æˆ
        if (gameState.coins >= 1000 && !gameState.goalReached) {
            gameState.goalReached = true;
            messageOverlay.style.display = 'flex';
        }
    } else {
        // é€šå¸¸ã®ãƒ‡ã‚£ãƒ¼ãƒ«å‡¦ç†
        dealCards();
    }
}

        // ãƒ‡ãƒƒã‚­ã‚’ä½œæˆã—ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«
        function createDeck() {
            const deck = [];
            
            // é€šå¸¸ã®ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ 
            Object.keys(suits).forEach(suit => {
                if (suit !== 'joker') {
                    Object.keys(values).forEach(value => {
                        if (value !== 'Joker') {
                            deck.push({
                                suit: suit,
                                value: value,
                                numericValue: values[value].value,
                                display: values[value].display,
                                suitDisplay: suits[suit].display,
                                color: suits[suit].color,
                                face: values[value].face || null
                            });
                        }
                    });
                }
            });
            
            // ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ã‚’1æšè¿½åŠ 
            deck.push({
                suit: 'joker',
                value: 'Joker',
                numericValue: values['Joker'].value,
                display: 'Joker',
                suitDisplay: suits['joker'].display,
                color: suits['joker'].color,
                face: null
            });
            
            // ãƒ‡ãƒƒã‚­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            
            return deck;
        }

        // ã‚³ã‚¤ãƒ³ã®è¡¨ç¤ºã‚’æ›´æ–°
        function updateCoinsDisplay() {
            coinsValue.textContent = gameState.coins;
        }

        // ã‚«ãƒ¼ãƒ‰ã‚’é…ã‚‹
        function dealCards() {
    // ãƒ€ãƒ–ãƒ«ã‚¢ãƒƒãƒ—ã®æ¬„ã‚’é–‰ã˜ã‚‹
    doubleUpContainer.style.display = 'none';
    
    // ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„
    if (gameState.coins < gameState.betAmount) {
        resultDiv.textContent = "ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“ï¼";
        return;
    }
    
    // ã‚³ã‚¤ãƒ³ã‚’æ¸›ã‚‰ã™
    gameState.coins -= gameState.betAmount;
    updateCoinsDisplay();
    
    // ãƒ‡ãƒƒã‚­ã‚’æ–°ã—ãä½œæˆ
    gameState.deck = createDeck();
    gameState.currentHand = [];
    gameState.heldCards = [false, false, false, false, false];
    gameState.replacedCardIndices = [];
    gameState.pendingWin = false;
    
    // ã‚«ãƒ¼ãƒ‰ã‚’è£å‘ãã«æˆ»ã™
    document.querySelectorAll('.card').forEach(card => {
        card.className = 'card card-back';
        card.innerHTML = '';
    });

    // ã‚«ãƒ¼ãƒ‰ã‚’ãƒ•ãƒªãƒƒãƒ—ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    setTimeout(() => {
        // 5æšã®ã‚«ãƒ¼ãƒ‰ã‚’é…ã‚‹
        for (let i = 0; i < 5; i++) {
            gameState.currentHand.push(gameState.deck.pop());
        }
        
        // ã‚«ãƒ¼ãƒ‰ã«ãƒ•ãƒªãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ã—ã¦ã‹ã‚‰è¡¨ç¤º
        for (let i = 0; i < 5; i++) {
            const cardElement = document.getElementById(`card-${i}`);
            cardElement.classList.add('flip');
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            cardElement.addEventListener('animationend', function handler() {
                cardElement.classList.remove('flip');
                cardElement.removeEventListener('animationend', handler);
            });
        }
        
        // ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
        renderHand();
        
        // ã‚²ãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚ºã‚’æ›´æ–°
        gameState.gamePhase = 'deal';
        
        // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
        dealBtn.disabled = true;
        drawBtn.disabled = false;
        
        // çµæœã‚’ã‚¯ãƒªã‚¢
        resultDiv.textContent = "";
    }, 300); // å°‘ã—é…å»¶ã•ã›ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç›®ç«‹ãŸã›ã‚‹
}

        // ã‚«ãƒ¼ãƒ‰ã‚’äº¤æ›
        function drawCards() {
            // äº¤æ›ã™ã‚‹ã‚«ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¨˜éŒ²
            gameState.replacedCardIndices = [];
            for (let i = 0; i < 5; i++) {
                if (!gameState.heldCards[i]) {
                    gameState.replacedCardIndices.push(i);
                }
            }
            
            // äº¤æ›ã™ã‚‹ã‚«ãƒ¼ãƒ‰ã«ãƒ•ãƒªãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
            const flipPromises = [];
            
            for (let i = 0; i < 5; i++) {
                if (!gameState.heldCards[i]) {
                    const cardElement = document.getElementById(`card-${i}`);
                    cardElement.classList.add('flip');
                    
                    // ãƒ—ãƒ­ãƒŸã‚¹ã‚’ä½œæˆã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ã‚’ç›£è¦–
                    const promise = new Promise(resolve => {
                        setTimeout(() => {
                            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­é–“ç‚¹ï¼ˆè£å‘ãï¼‰ã§ã‚«ãƒ¼ãƒ‰ã‚’äº¤æ›
                            gameState.currentHand[i] = gameState.deck.pop();
                            resolve();
                        }, 300); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®åŠåˆ†ã®æ™‚é–“
                    });
                    
                    flipPromises.push(promise);
                    
                    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                    cardElement.addEventListener('animationend', function handler() {
                        cardElement.classList.remove('flip');
                        cardElement.removeEventListener('animationend', handler);
                    });
                }
            }
            
            // ã™ã¹ã¦ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­é–“ç‚¹ã‚’å¾…ã£ã¦ã‹ã‚‰å‡¦ç†ã‚’ç¶šè¡Œ
            Promise.all(flipPromises).then(() => {
                // ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
                renderHand();
                
                // å½¹ã‚’è©•ä¾¡
                evaluateHand();
                
                // ã‚²ãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚ºã‚’æ›´æ–°
                gameState.gamePhase = 'result';
                
                // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
                dealBtn.disabled = false;
                drawBtn.disabled = true;
            });
        }

        // æ‰‹æœ­ã‚’æç”»
        function renderHand() {
            for (let i = 0; i < 5; i++) {
                const cardElement = document.getElementById(`card-${i}`);
                cardElement.className = 'card';
                
                // æ–°ã—ãäº¤æ›ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœã‚’è¿½åŠ 
                if (gameState.gamePhase === 'result' && gameState.replacedCardIndices.includes(i)) {
                    cardElement.classList.add('new-card');
                }
                
                cardElement.innerHTML = '';
                
                if (gameState.currentHand[i]) {
                    const card = gameState.currentHand[i];
                    
                    if (card.suit === 'joker') {
                        const suitElement = document.createElement('div');
                        suitElement.className = `card-suit ${card.color}`;
                        suitElement.textContent = card.suitDisplay;
                        cardElement.appendChild(suitElement);
                        
                        const valueElement = document.createElement('div');
                        valueElement.className = `card-value ${card.color}`;
                        valueElement.textContent = card.display;
                        cardElement.appendChild(valueElement);
                    } else {
                        const valueElement = document.createElement('div');
                        valueElement.className = `card-value ${card.color}`;
                        valueElement.textContent = card.display;
                        cardElement.appendChild(valueElement);
                        
                        // K, Q, J ã«ã¯çµµæŸ„ã‚’è¿½åŠ 
                        if (card.face) {
                            const faceElement = document.createElement('div');
                            faceElement.className = 'face-card';
                            faceElement.textContent = card.face;
                            cardElement.appendChild(faceElement);
                        } else {
                            const suitElement = document.createElement('div');
                            suitElement.className = `card-suit ${card.color}`;
                            suitElement.textContent = card.suitDisplay;
                            cardElement.appendChild(suitElement);
                        }
                        
                        const valueBottomElement = document.createElement('div');
                        valueBottomElement.className = `card-value-bottom ${card.color}`;
                        valueBottomElement.textContent = card.display;
                        cardElement.appendChild(valueBottomElement);
                    }
                    
                    if (gameState.heldCards[i] && gameState.gamePhase === 'deal') {
                        // ãƒˆãƒ©ãƒ³ãƒ—ã®ä¸‹ã«ãƒ›ãƒ¼ãƒ«ãƒ‰ã¨è¡¨ç¤º
                        const heldText = document.createElement('div');
                        heldText.className = 'held-text';
                        heldText.textContent = 'ãƒ›ãƒ¼ãƒ«ãƒ‰';
                        cardElement.appendChild(heldText);
                    }
                } else {
                    cardElement.className = 'card card-back';
                }
            }
        }

        // ãƒ›ãƒ¼ãƒ«ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
        function toggleHold(index) {
            if (gameState.gamePhase === 'deal') {
                gameState.heldCards[index] = !gameState.heldCards[index];
                renderHand();
            }
        }

        // å½¹ã‚’è©•ä¾¡ã™ã‚‹
        function evaluateHand() {
            // ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼è£œå®Œã®å‰ã«å½¹ã‚’ç¢ºèª
            const handResult = checkHand(gameState.currentHand);
            
            resultDiv.textContent = handResult.handName;
            
            if (handResult.payout > 0) {
                // é…å½“ã‚’è¨­å®š
                gameState.winAmount = handResult.payout;
                resultDiv.textContent += ` - ${gameState.winAmount}ã‚³ã‚¤ãƒ³`;
                
                // å‹åˆ©é‡‘é¡ã‚’ä¿ç•™çŠ¶æ…‹ã«ã™ã‚‹
                gameState.pendingWin = true;
                
                // ãƒ€ãƒ–ãƒ«ã‚¢ãƒƒãƒ—å¯èƒ½ãªå ´åˆ
                gameState.doubleUpAmount = gameState.winAmount;
                prepareDoubleUp();
            } else {
                resetGameForNextDeal();
            }
        }

        // å½¹ã‚’ç¢ºèªã™ã‚‹é–¢æ•°
        function checkHand(hand) {
            // ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹
            const jokerIndices = hand.map((card, index) => 
                card.suit === 'joker' ? index : -1).filter(index => index !== -1);
            
            // ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ãŒã‚ã‚‹å ´åˆã®æœ€é©ãªå½¹ã‚’è¦‹ã¤ã‘ã‚‹
            if (jokerIndices.length > 0) {
                return findBestHandWithJokers(hand, jokerIndices);
            }
            
            // ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ãŒãªã„å ´åˆã¯é€šå¸¸ã®å½¹åˆ¤å®š
            return evaluateHandNormal(hand);
        }

        // ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ã‚’è€ƒæ…®ã—ã¦æœ€é©ãªå½¹ã‚’è¦‹ã¤ã‘ã‚‹é–¢æ•°
        function findBestHandWithJokers(hand, jokerIndices) {
            // ã™ã¹ã¦ã®å¯èƒ½ãªçµ„ã¿åˆã‚ã›ã‚’è©¦ã™ï¼ˆå˜ç´”åŒ–ã®ãŸã‚ï¼‰
            let bestHand = { handName: 'ãƒãƒ¼ãƒšã‚¢', payout: 0 };
            
            // ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ã‚’å„ã‚¹ãƒ¼ãƒˆã¨æ•°å­—ã§ç½®ãæ›ãˆã¦ã¿ã‚‹
            Object.keys(suits).forEach(suit => {
                if (suit !== 'joker') {
                    Object.keys(values).forEach(value => {
                        if (value !== 'Joker') {
                            const tempHand = [...hand];
                            jokerIndices.forEach(idx => {
                                tempHand[idx] = {
                                    suit: suit,
                                    value: value,
                                    numericValue: values[value].value,
                                    display: values[value].display,
                                    suitDisplay: suits[suit].display,
                                    color: suits[suit].color,
                                    face: values[value].face || null
                                };
                            });
                            
                            const result = evaluateHandNormal(tempHand);
                            if (result.payout > bestHand.payout) {
                                bestHand = result;
                            }
                        }
                    });
                }
            });
            
            return bestHand;
        }

        // é€šå¸¸ã®å½¹åˆ¤å®šé–¢æ•°
        function evaluateHandNormal(hand) {
            // å½¹ã®åˆ¤å®šç”¨ã«æ•°å€¤ã¨ã‚¹ãƒ¼ãƒˆã®é…åˆ—ã‚’ä½œæˆ
            const values = hand.map(card => card.numericValue);
            const suits = hand.map(card => card.suit);
            
            // å„æ•°å€¤ã®å‡ºç¾å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            const valueCounts = {};
            values.forEach(value => {
                valueCounts[value] = (valueCounts[value] || 0) + 1;
            });
            
            // å‡ºç¾å›æ•°ã®é…åˆ—
            const counts = Object.values(valueCounts);
            
            // åŒã˜ã‚¹ãƒ¼ãƒˆã‹ã©ã†ã‹
            const isFlush = suits.every(suit => suit === suits[0]);
            
            // ã‚½ãƒ¼ãƒˆã—ãŸå€¤
            const sortedValues = [...values].sort((a, b) => a - b);
            
            // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã‹ã©ã†ã‹ï¼ˆAã¯1ã¨ã—ã¦ã‚‚14ã¨ã—ã¦ã‚‚æ‰±ã†ï¼‰
            let isStraight = true;
            for (let i = 1; i < sortedValues.length; i++) {
                if (sortedValues[i] !== sortedValues[i-1] + 1) {
                    isStraight = false;
                    break;
                }
            }
            
            // A-5ã®ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã®ç‰¹åˆ¥ã‚±ãƒ¼ã‚¹
            if (!isStraight && sortedValues[0] === 2 && sortedValues[4] === 14) {
                const tempValues = [1, ...sortedValues.slice(0, 4)];
                isStraight = true;
                for (let i = 1; i < tempValues.length; i++) {
                    if (tempValues[i] !== tempValues[i-1] + 1) {
                        isStraight = false;
                        break;
                    }
                }
            }
            
            // ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆ10, J, Q, K, A ã®åŒã˜ã‚¹ãƒ¼ãƒˆï¼‰
            const isRoyal = JSON.stringify(sortedValues.sort()) === JSON.stringify([10, 11, 12, 13, 14]);
            
            // ãƒ•ã‚¡ã‚¤ãƒ–ã‚«ãƒ¼ãƒ‰ (5æšåŒã˜æ•°å­—ã€ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ä½¿ç”¨æ™‚ã®ã¿å¯èƒ½)
            if (counts.includes(5)) {
                return { handName: 'ãƒ•ã‚¡ã‚¤ãƒ–ã‚«ãƒ¼ãƒ‰', payout: payouts['ãƒ•ã‚¡ã‚¤ãƒ–ã‚«ãƒ¼ãƒ‰'] };
            }
            
            // ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥
            if (isFlush && isStraight && isRoyal) {
                return { handName: 'ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥', payout: payouts['ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥'] };
            }
            
            // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥
            if (isFlush && isStraight) {
                return { handName: 'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥', payout: payouts['ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥'] };
            }
            
            // ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰
            if (counts.includes(4)) {
                return { handName: 'ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰', payout: payouts['ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰'] };
            }
            
            // ãƒ•ãƒ«ãƒã‚¦ã‚¹
            if (counts.includes(3) && counts.includes(2)) {
                return { handName: 'ãƒ•ãƒ«ãƒã‚¦ã‚¹', payout: payouts['ãƒ•ãƒ«ãƒã‚¦ã‚¹'] };
            }
            
            // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥
            if (isFlush) {
                return { handName: 'ãƒ•ãƒ©ãƒƒã‚·ãƒ¥', payout: payouts['ãƒ•ãƒ©ãƒƒã‚·ãƒ¥'] };
            }
            
            // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ
            if (isStraight) {
                return { handName: 'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ', payout: payouts['ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ'] };
            }
            
            // ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰
            if (counts.includes(3)) {
                return { handName: 'ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰', payout: payouts['ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰'] };
            }
            
            // ãƒ„ãƒ¼ãƒšã‚¢
            if (counts.filter(count => count === 2).length === 2) {
                return { handName: 'ãƒ„ãƒ¼ãƒšã‚¢', payout: payouts['ãƒ„ãƒ¼ãƒšã‚¢'] };
            }
            
            // ãƒ¯ãƒ³ãƒšã‚¢
            if (counts.includes(2)) {
                return { handName: 'ãƒ¯ãƒ³ãƒšã‚¢', payout: payouts['ãƒ¯ãƒ³ãƒšã‚¢'] };
            }
            
            // ãƒãƒ¼ãƒšã‚¢
            return { handName: 'ãƒãƒ¼ãƒšã‚¢', payout: 0 };
        }

        // ãƒ€ãƒ–ãƒ«ã‚¢ãƒƒãƒ—ã®æº–å‚™
        function prepareDoubleUp() {
            gameState.gamePhase = 'doubleUp';
            
            // æ–°ã—ã„ãƒ‡ãƒƒã‚­ã‚’ç”¨æ„
            gameState.deck = createDeck();
            
            // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã
            gameState.dealerCard = gameState.deck.pop();
            
            // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
            renderDealerCard();
            
            // ã‚«ãƒ¼ãƒ‰æ¯”è¼ƒã‚¨ãƒªã‚¢ã‚’åˆæœŸåŒ–ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆã¯å‰Šé™¤ï¼‰
            const existingPlayerCard = document.getElementById('player-card');
            if (existingPlayerCard) {
                existingPlayerCard.remove();
            }
            
            // ç²å¾—é‡‘é¡ã‚’è¡¨ç¤º
            winAmountDiv.textContent = `ç²å¾—ã‚³ã‚¤ãƒ³: ${gameState.doubleUpAmount}`;
            
            // ãƒ€ãƒ–ãƒ«ã‚¢ãƒƒãƒ—ã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤º
            doubleUpContainer.style.display = 'flex';
        }

        // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®ã‚«ãƒ¼ãƒ‰ã‚’æç”»
        function renderDealerCard() {
            dealerCardDiv.innerHTML = '';
            dealerCardDiv.className = 'card'; // è£é¢ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã—ã€ç™½ã„èƒŒæ™¯ã«ã™ã‚‹
            
            const card = gameState.dealerCard;
            
            if (card.suit === 'joker') {
                const suitElement = document.createElement('div');
                suitElement.className = `card-suit ${card.color}`;
                suitElement.textContent = card.suitDisplay;
                dealerCardDiv.appendChild(suitElement);
                
                const valueElement = document.createElement('div');
                valueElement.className = `card-value ${card.color}`;
                valueElement.textContent = card.display;
                dealerCardDiv.appendChild(valueElement);
            } else {
                const valueElement = document.createElement('div');
                valueElement.className = `card-value ${card.color}`;
                valueElement.textContent = card.display;
                dealerCardDiv.appendChild(valueElement);
                
                // K, Q, J ã«ã¯çµµæŸ„ã‚’è¿½åŠ 
                if (card.face) {
                    const faceElement = document.createElement('div');
                    faceElement.className = 'face-card';
                    faceElement.textContent = card.face;
                    dealerCardDiv.appendChild(faceElement);
                } else {
                    const suitElement = document.createElement('div');
                    suitElement.className = `card-suit ${card.color}`;
                    suitElement.textContent = card.suitDisplay;
                    dealerCardDiv.appendChild(suitElement);
                }
                
                const valueBottomElement = document.createElement('div');
                valueBottomElement.className = `card-value-bottom ${card.color}`;
                valueBottomElement.textContent = card.display;
                dealerCardDiv.appendChild(valueBottomElement);
            }
        }

        // ãƒ€ãƒ–ãƒ«ã‚¢ãƒƒãƒ—
        function doubleUp(choice) {
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã
            gameState.playerCard = gameState.deck.pop();
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
            const playerCardDiv = document.createElement('div');
            playerCardDiv.className = 'card flip';
            playerCardDiv.id = 'player-card';
            
            // æ¨ªã«ä¸¦ã¹ã‚‹ãŸã‚ã«ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã‚«ãƒ¼ãƒ‰ã®å¾Œã‚ã§ã¯ãªã cards-comparison ã®ä¸­ã«è¿½åŠ 
            cardsComparisonDiv.appendChild(playerCardDiv);
            
            setTimeout(() => {
                // ã‚«ãƒ¼ãƒ‰ã®æƒ…å ±ã‚’è¨­å®š
                const card = gameState.playerCard;
                
                if (card.suit === 'joker') {
                    const suitElement = document.createElement('div');
                    suitElement.className = `card-suit ${card.color}`;
                    suitElement.textContent = card.suitDisplay;
                    playerCardDiv.appendChild(suitElement);
                    
                    const valueElement = document.createElement('div');
                    valueElement.className = `card-value ${card.color}`;
                    valueElement.textContent = card.display;
                    playerCardDiv.appendChild(valueElement);
                } else {
                    const valueElement = document.createElement('div');
                    valueElement.className = `card-value ${card.color}`;
                    valueElement.textContent = card.display;
                    playerCardDiv.appendChild(valueElement);
                    
                    // K, Q, J ã«ã¯çµµæŸ„ã‚’è¿½åŠ 
                    if (card.face) {
                        const faceElement = document.createElement('div');
                        faceElement.className = 'face-card';
                        faceElement.textContent = card.face;
                        playerCardDiv.appendChild(faceElement);
                    } else {
                        const suitElement = document.createElement('div');
                        suitElement.className = `card-suit ${card.color}`;
                        suitElement.textContent = card.suitDisplay;
                        playerCardDiv.appendChild(suitElement);
                    }
                    
                    const valueBottomElement = document.createElement('div');
                    valueBottomElement.className = `card-value-bottom ${card.color}`;
                    valueBottomElement.textContent = card.display;
                    playerCardDiv.appendChild(valueBottomElement);
                }
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                playerCardDiv.addEventListener('animationend', function handler() {
                    playerCardDiv.classList.remove('flip');
                    playerCardDiv.removeEventListener('animationend', handler);
                    
                    // å‹æ•—åˆ¤å®š
                    let result;
                    
                    // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ•°å€¤ã‚’æ¯”è¼ƒ
                    const dealerValue = gameState.dealerCard.numericValue;
                    const playerValue = gameState.playerCard.numericValue;
                    
                    if (dealerValue === playerValue) {
                        // å¼•ãåˆ†ã‘ã®å ´åˆã¯å†æŒ‘æˆ¦
                        result = 'draw';
                        resultDiv.textContent = "å¼•ãåˆ†ã‘ - ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼";
                        
                        // å°‘ã—å¾…ã£ã¦ã‹ã‚‰æ–°ã—ã„ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã„ã¦è¡¨ç¤º
                        setTimeout(() => {
                            // å¤ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤
                            playerCardDiv.remove();
                            
                            // æ–°ã—ã„ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã„ã¦è¡¨ç¤ºï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
                            gameState.dealerCard = gameState.deck.pop();
                            dealerCardDiv.classList.add('flip');
                            
                            setTimeout(() => {
                                renderDealerCard();
                                
                                dealerCardDiv.addEventListener('animationend', function animEnd() {
                                    dealerCardDiv.classList.remove('flip');
                                    dealerCardDiv.removeEventListener('animationend', animEnd);
                                });
                            }, 300);
                        }, 1000);
                        
                        return;
                    } else if ((choice === 'higher' && playerValue > dealerValue) || 
                               (choice === 'lower' && playerValue < dealerValue)) {
                        // å‹ã¡
                        result = 'win';
                        gameState.doubleUpAmount *= 2;
                        resultDiv.textContent = `å‹ã¡ï¼ ${gameState.doubleUpAmount}ã‚³ã‚¤ãƒ³ï¼`;
                        winAmountDiv.textContent = `ç²å¾—ã‚³ã‚¤ãƒ³: ${gameState.doubleUpAmount}`;
                        
                        // å°‘ã—å¾…ã£ã¦ã‹ã‚‰æ–°ã—ã„ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã
                        setTimeout(() => {
                            // å¤ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤
                            playerCardDiv.remove();
                            
                            // æ–°ã—ã„ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã„ã¦è¡¨ç¤ºï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
                            gameState.dealerCard = gameState.deck.pop();
                            dealerCardDiv.classList.add('flip');
                            
                            setTimeout(() => {
                                renderDealerCard();
                                
                                dealerCardDiv.addEventListener('animationend', function animEnd() {
                                    dealerCardDiv.classList.remove('flip');
                                    dealerCardDiv.removeEventListener('animationend', animEnd);
                                });
                            }, 300);
                        }, 1000);
                    } else {
                        // è² ã‘
                        result = 'lose';
                        gameState.doubleUpAmount = 0;
                        gameState.pendingWin = false; // å‹åˆ©é‡‘ã‚’ãƒªã‚»ãƒƒãƒˆ
                        resultDiv.textContent = "è² ã‘ï¼ ã‚³ã‚¤ãƒ³ã‚’å¤±ã„ã¾ã—ãŸã€‚";
                        
                        // ãƒ€ãƒ–ãƒ«ã‚¢ãƒƒãƒ—ã‚’çµ‚äº†
                        setTimeout(() => {
                            playerCardDiv.remove();
                            doubleUpContainer.style.display = 'none';
                            resetGameForNextDeal();
                        }, 1500);
                    }
                });
            }, 300); // ãƒ•ãƒªãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸­é–“ç‚¹
        }

        // ç²å¾—é‡‘é¡ã‚’å—ã‘å–ã‚‹
        function collectWinnings() {
            // ã‚³ã‚¤ãƒ³ã‚’åŠ ç®—
            gameState.coins += gameState.doubleUpAmount;
            updateCoinsDisplay();
            
            // å‹åˆ©é‡‘ã‚’ãƒªã‚»ãƒƒãƒˆ
            gameState.pendingWin = false;
            
            // ãƒ€ãƒ–ãƒ«ã‚¢ãƒƒãƒ—ã‚’çµ‚äº†
            doubleUpContainer.style.display = 'none';
            
            // ä¿®æ­£ç‚¹: ç²å¾—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã›ãšã€ã™ãã«æ¬¡ã®ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹
            dealCards();
            
            // 1000ã‚³ã‚¤ãƒ³ä»¥ä¸Šã§ã‚´ãƒ¼ãƒ«é”æˆ
            if (gameState.coins >= 1000 && !gameState.goalReached) {
                gameState.goalReached = true;
                messageOverlay.style.display = 'flex';
            }
        }

        // æ¬¡ã®ãƒ‡ã‚£ãƒ¼ãƒ«ã®ãŸã‚ã«ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
        function resetGameForNextDeal() {
            gameState.gamePhase = 'initial';
            dealBtn.disabled = false;
            drawBtn.disabled = true;
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        initGame();
    </script>
</body>
</html>
